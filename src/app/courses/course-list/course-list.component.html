<h2>{{title}}</h2>
<div>
  <button  class="btn btn-primary" routerLink="search/">Procurar</button>
</div>

<div *ngIf="!this.authService.isLoggedIn; else elseBlock">
  
  <div *ngIf="courses$">
    <table>
      <tr>
        <td>Nome</td>
        <td>Descrição</td>
        <td>Ações</td>
      </tr>
      <tr *ngFor="let course of (courses$ | async)">
        <td>{{course.name}}</td>
        <td>{{course.description}}</td>
        <!-- TODO: create logic on TS to unauth users - Register or Login -->
        <td>
          <button  class="btn btn-primary" routerLink="subscribe/">Inscrever-se</button>
        </td>
      </tr>
    </table>
  </div>
</div>

<ng-template #elseBlock>
  <container [ngSwitch]="userRole">
    <div *ngSwitchCase="'admin'">
      <div>
        <button  class="btn btn-primary" routerLink="form/">Novo</button>
        <button  class="btn btn-primary" routerLink="random/">(+ aleatorio)</button>
      </div>
      <div *ngIf="courses$">
        <table>
          <tr>
            <td>ID</td>
            <td>Curso</td>
            <td>Descrição</td>
            <td>Ações</td>
          </tr>
          <tr *ngFor="let course of (courses$ | async)">
            <td>{{course._id}}</td>
            <td>{{course.name}}</td>
            <td>{{course.description}}</td>
            <td>
              <button  class="btn btn-primary" routerLink="edit/{{course._id}}">Editar</button>
              <button  class="btn btn-primary" routerLink="remove/{{course._id}}">Deletar</button>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div *ngSwitchCase="'teacher'">
      <div *ngIf="isOwnCourses">
        <button  class="btn btn-primary" routerLink="form/">Novo</button>
        <button  class="btn btn-primary" routerLink="random/">(+ aleatorio)</button>
      </div>
      <div *ngIf="courses$">
        <table>
          <tr>
            <td>Curso</td>
            <td>Descrição</td>
            <td *ngIf="isOwnCourses">Alunos</td>
            <td *ngIf="isOwnCourses">Ações</td>
          </tr>
          <tr *ngFor="let course of (courses$ | async)">
            <td>{{course.name}}</td>
            <td>{{course.description}}</td>
            <td *ngIf="isOwnCourses">
              <ol>
                <li *ngFor="let student of course.students">
                  {{student.name}}
                </li>
              </ol>
            <td *ngIf="isOwnCourses">
              <button  class="btn btn-primary" *ngIf="isOwnCourses"
                      routerLink="edit/{{course._id}}">Editar info
              </button>
              <button  class="btn btn-danger" (click)="deleteCourse(course._id)">Excluir</button>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div *ngSwitchCase="'student'">
      <div *ngIf="courses$">
        <table>
          <tr>
            <td>Curso</td>
            <td>Descrição</td>
            <td>Instrutor(a)</td>
            <td>Ações</td>
          </tr>
          <tr *ngFor="let course of (courses$ | async)">
            <td>{{course.name}}</td>
            <td>{{course.description}}</td>
            <td>{{course.teacher.name}}</td>
            <td>
              <button  class="btn btn-secondary" *ngIf="isOwnCourses"
                      (click)="unsubscribe(course._id)">Cancelar inscrição
              </button>
              <button  class="btn btn-primary" *ngIf="!isOwnCourses"
                      (click)="subscribe(course._id)">Inscrever-se
              </button>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div *ngSwitchDefault>
      <p>Error</p>
    </div>

  </container>
</ng-template>